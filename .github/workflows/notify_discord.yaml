name: notify

on:
  pull_request:
    types: [opened, closed]
  pull_request_review:
    types: [submitted]

jobs:
  notify:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: Send message for pull request opened
        if: github.event_name == 'pull_request' && github.event.action == 'opened'
        uses: appleboy/discord-action@master
        with:
          webhook_url: ${{ secrets.DISCORD_WEBHOOK }}
          username: "GitHub Bot"
          avatar_url: "https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png"
          message: |
            ğŸ‰ **OlÃ¡! Um novo Pull Request foi aberto no repositÃ³rio:** [${{ github.event.repository.name }}](${{ github.event.repository.html_url }})

            **TÃ­tulo:** ${{ github.event.pull_request.title }}

            ğŸ‘¤ **Autor:** ${{ github.event.pull_request.user.login }}
            ğŸ”¢ **PR #${{ github.event.pull_request.number }}**
            ğŸŒ¿ **Branch:** ${{ github.event.pull_request.head.ref }} â†’ ${{ github.event.pull_request.base.ref }}

            ğŸ”— **[Ver Pull Request](${{ github.event.pull_request.html_url }})**

      - name: Send message for pull request approved and ready to merge
        if: github.event_name == 'pull_request_review' && github.event.review.state == 'approved'
        uses: appleboy/discord-action@master
        with:
          webhook_url: ${{ secrets.DISCORD_WEBHOOK }}
          username: "GitHub Bot"
          avatar_url: "https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png"
          message: |
            âœ… **Pull Request aprovado e pronto para merge!** [${{ github.event.repository.name }}](${{ github.event.repository.html_url }})

            **TÃ­tulo:** ${{ github.event.pull_request.title }}

            ğŸ‘¤ **Autor:** ${{ github.event.pull_request.user.login }}
            ğŸ‘¨â€ğŸ’» **Aprovado por:** ${{ github.event.review.user.login }}
            ğŸ”¢ **PR #${{ github.event.pull_request.number }}**
            ğŸŒ¿ **Branch:** ${{ github.event.pull_request.head.ref }} â†’ ${{ github.event.pull_request.base.ref }}

            ğŸ“ **Status:** Aprovado e pronto para merge! ğŸš€

            ğŸ”— **[Ver Pull Request](${{ github.event.pull_request.html_url }})**

      - name: Send message for pull request merged
        if: github.event_name == 'pull_request' && github.event.action == 'closed' && github.event.pull_request.merged == true
        uses: appleboy/discord-action@master
        with:
          webhook_url: ${{ secrets.DISCORD_WEBHOOK }}
          username: "GitHub Bot"
          avatar_url: "https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png"
          message: |            
            âœ… **OlÃ¡! O Pull Request foi mergeado no repositÃ³rio:** [${{ github.event.repository.name }}](${{ github.event.repository.html_url }})

            **TÃ­tulo:** ${{ github.event.pull_request.title }}

            ğŸ‘¤ **Autor:** ${{ github.event.pull_request.user.login }}
            ğŸ”¢ **PR #${{ github.event.pull_request.number }}**
            ğŸŒ¿ **Branch:** ${{ github.event.pull_request.head.ref }} â†’ ${{ github.event.pull_request.base.ref }}

            ğŸ”— **[Ver Pull Request](${{ github.event.pull_request.html_url }})**